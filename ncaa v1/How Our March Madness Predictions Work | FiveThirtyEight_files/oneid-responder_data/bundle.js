(()=>{"use strict";var e={742:(e,t)=>{for(var n=[],o=[],r="undefined"!==typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,i=a.length;u<i;++u)n[u]=a[u],o[a.charCodeAt(u)]=u;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function d(e,t,o){for(var r,a,u=[],i=t;i<o;i+=3)r=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),u.push(n[(a=r)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return u.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}(()=>{const e={ERROR:5,WARN:4,INFO:3,DEBUG:2,LOG:1,OFF:100};let t=e.INFO,o=!1;const r={ERROR:"color:#FC0C1B;background-color:#FFEFEF",WARN:"color:#5B3A06;background-color:#FFFBE6",INFO:"color:#363F47;background-color:#e1e9ff",DEBUG:"color:#444;background-color:#eee",LOG:"color:#000;background-color:transparent",DEFAULT:"color:#000;background-color:transparent;font-weight:",ONEID:"color:#2887b4;background-color:transparent;font-weight:bold"};let a=i();function u(n){return t>e[n]?(e="",t={})=>{}:o?function(e){const t=["%c[OneID]%c %c[%s]%c: ",r.ONEID,r.DEFAULT,r[e],e,r.DEFAULT];return window.console[e.toLowerCase()].bind(window.console,...t)}(n):function(e){return window.console[e.toLowerCase()].bind(window.console,"[OneID] [%s]: ",e)}(n)}function i(){return{error:u("ERROR"),warn:u("WARN"),info:u("INFO"),debug:u("DEBUG"),log:u("LOG")}}const c=["CALL","CALL_DONE","EVENT"];function d(){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_=+";let t="";for(let n=0;n<24;n+=1){t+=e[Math.floor(Math.random()*e.length)]}return t}function s(e,t="DEFAULT"){const n=`PatchBay[${t}]`,o={},r={},u={};return Object.keys(e).forEach((t=>{e[t].onmessage=function(e){return t=>{if(!t||!t.data||"object"!==typeof t.data)return;const n=t.data;-1!==c.indexOf(n.type)&&(i(n.name,e,n),setTimeout(s.bind(null,n.name)))}}(t)})),{addHandler:function(e,t){if("function"!==typeof t)return;o[e]=t,s(e)},message:f,broadcast:function(t,n){const o={id:d(),type:"EVENT",data:n,name:t};i(t,null,o),setTimeout(s.bind(null,t)),Object.keys(e).forEach((e=>{f(e,t,n)}))},call:function(e,t,o){return new Promise(((r,i)=>{let c=d();a.debug(`${n}: call() invoked, target=${e}, name=${t}, id=${c}`),u[c]={resolve:r,reject:i},g(e,t,"CALL",o,c)}))}};function i(e,t,o){a.debug(`${n}: queueMessage(name=${e}, source=${t})`),r[e]||(r[e]=[]),r[e].push({source:t,data:o})}function s(e){if(a.debug(`${n}: flushQueue(name=${e})`),!Array.isArray(r[e])||r[e].length<1)return void a.debug(`${n}: Nothing in queue for '${e}', exit early`);const t=[];for(;r[e].length;){const{source:i,data:c}=r[e].pop(),d=c&&c.type||void 0,s=c&&c.id||void 0,f=`${n} - ${s||"NO_ID"}`;if(a.debug(`${f}: flushQueue loop, source=${i}, type=${d}`),"CALL"===d||"EVENT"===d){let n;if(!o[e]){a.debug(`${f}: flushQueue loop, NO HANDLER FOR name=${e}, deferring`),t.push({source:i,data:c});continue}a.debug(`${f}: flushQueue loop, about to call handler for name=${e}`),n=o[e](c&&c.data),a.debug(`${f}: flushQueue loop, obtained return value from name=${e}`),"CALL"===d&&(n&&n.then||(a.debug(`${f}: flushQueue loop, handler for name=${e} returned plain value`),n=Promise.resolve(n)),n.then((t=>{a.debug(`${f}: flushQueue, promise resolved for name=${e}, messaging back`),l(i,e,t,s,"resolved")})).catch((t=>{a.debug(`${f}: flushQueue, promise caught error for name=${e}, messaging back`),l(i,e,t,s,"rejected")})))}if("CALL_DONE"===d){const e=c.status;if(!u[s]){a.debug(`${f}: flushQueue loop, pendingCalls EMPTY FOR id=${s}!!!`);continue}"resolved"===e?(a.debug(`${f}: flushQueue loop, resolving promise for id=${s}`),u[s].resolve(c.data)):(a.debug(`${f}: flushQueue loop, rejecting promise for id=${s}`),u[s].reject(c.data)),delete u[s]}}for(let o of t)a.debug(`${n}: flushQueue, pushing deferred item back into queue, name=${e}`),r[e].push(o)}function l(e,t,n,o,r){g(e,t,"CALL_DONE",n,o,r)}function f(e,t,n){g(e,t,"EVENT",n)}function g(o,r,u,c,l,f){if(l=l||d(),o===t)return a.debug(`${n}: Target is self...`),i(r,o,{id:l,type:u,name:r,data:c,status:f}),void setTimeout(s.bind(null,r));e[o]?e[o].postMessage({id:l,type:u,name:r,data:c,status:f}):a.debug(`${n}: Target '${o}' has not been registered!!!`)}}const l=(f="responder",new Promise((e=>{const t={};window.addEventListener("message",(function n(o){o.data&&o.data.targetName===f&&("comm-bootstrap-start"===o.data.event&&o.source.postMessage({event:"comm-bootstrap-ack",targetName:f},"*"),"comm-bootstrap-data"===o.data.event&&(t[o.data.port]=o.ports[0],Object.keys(t).length>=o.data.ports.length&&(window.removeEventListener("message",n),e(t))))}))}))).then((e=>new s(e,"responder")));var f;n(742);function g(e=""){if("string"!==typeof e)return 0;let t=-1;const n=function(){const e=new Array(256);for(let t=0;t<e.length;t++){let n=t;for(let e=0;e<8;e++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n>>>0}return e}();for(let o=0;o<e.length;o++)t=t>>>8^n[255&(t^e.charCodeAt(o))];return(-1^t)>>>0}const $="ac",p="ab2",h="idn",m="rt",w="token",b="ts",v=/^\.?www/,E=/^\./;function k(e){return e&&document.cookie.replace(new RegExp(`(?:(?:^|.*;\\s*)${e}\\s*\\=\\s*([^;]*).*$)|^.*$`),"$1")||null}function L(e,t,n){if(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(t?`; domain=${t}`:"")+(n?`; path=${n}`:""),t&&!v.test(t)){const o=`www${/^\./.test(t)?"":"."}${t}`;a.debug(`also deleting cookie from ${o}`),L(e,o,n)}return!0}function y(e){let t=window.location.hostname;v.test(t)&&(t=t.replace(v,""),t=t.replace(E,""));const n="localhost"===t?t:`.${t}`;a.debug("responder: guestLogout");[p,h,m,w,b].forEach((t=>{const o=`${e}.${t}`;a.debug(`deleting cookie: ${o}`),L(o,n,"/")})),a.debug(`deleting cookie: ${e}-${$}`),L(`${e}-${$}`,n,"/")}const O=18e5,A=9e5;function D(e){if(!e)return null;return k(`device_${g(e).toString(16)}`)}function R({deviceId:e,loginValue:t}){if(!e||!t)return null;const n=g(t);let o=new Date;o.setDate(o.getDate()+1),T({key:`device_${n.toString(16)}`,value:e,expires:o,secure:!0})}function N(){const e=new URLSearchParams(window.location.search);return k(`${e.get("clientId")}-${e.get("environment")}.${p}`)}function F(){const e=new URLSearchParams(window.location.search),t=e.get("clientId"),n=e.get("environment"),o=new Date(Date.now()+O);T({key:`${t}-${n}.${p}`,value:o.toISOString(),expires:o,secure:!0})}function T({key:e,value:t,expires:n,secure:o=!1}){let r=window.location.hostname;!function(e,t,n,o,r,u){let i,c=!1;if(v.test(n)&&(n=n.replace(v,""),c=!0),!e||/^(?:expires|max-age|path|domain|secure)$/i.test(e))return!1;if(i=`${e}=${t}`,r&&r instanceof Date&&(i+=`; expires=${r.toUTCString()}`),n&&(i+=`; domain=${n}`),o&&(i+=`; path=${o}`),u&&(i+="; secure"),document.cookie=i,c){const t=`www${/^\./.test(n)?"":"."}${n}`;a.debug(`calling delete on domain ${t}`),L(e,t,o||"")}}(e,t,"localhost"===r?r:`.${r}`,"/",n,o)}function I({recoveryToken:e}){const t=new URLSearchParams(window.location.search),n=t.get("clientId"),o=t.get("environment"),r=new Date(Date.now()+A);T({key:`${n}-${o}.${m}`,value:e,expires:r,secure:!0})}function C(){const e=new URLSearchParams(window.location.search);return k(`${e.get("clientId")}-${e.get("environment")}.${m}`)}l.then((e=>{e.addHandler("deviceID.read",D),e.addHandler("deviceID.write",R),e.addHandler("ageBandGating.read",N),e.addHandler("ageBandGating.write",F),e.addHandler("otpRecoveryToken.write",I),e.addHandler("otpRecoveryToken.read",C),e.addHandler("get.apiKey",k),e.addHandler("get.cookie",k),e.addHandler("set.cookie",T),e.addHandler("delete.cookie",L),e.addHandler("guest.logout",y)}))})()})();